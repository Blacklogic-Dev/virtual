<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | Virtual Labs</title>

<!-- TailwindCSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  body { background: linear-gradient(to bottom, #16a34a, #000); }
  .banner { width: 100%; height: 200px; background-size: cover; background-position: center; border-radius: 12px; margin-bottom: 20px; }
  .receipt-box { font-family: "Courier New", monospace; background: white; color: black; padding: 15px; border-radius: 10px; margin-top: 10px; white-space: pre-line; }
</style>
</head>

<body class="text-white min-h-screen p-6 font-sans">

<script>
  if(sessionStorage.getItem("adminAccess") !== "granted"){
    alert("Unauthorized Access");
    window.location.href = "index.html";
  }
</script>

<!-- Banner -->
<div class="banner shadow-lg" style="background-image: url('labs2.png')"></div>

<!-- Header -->
<div class="flex justify-between items-center mb-6">
  <h1 class="text-3xl font-bold">Admin Dashboard</h1>
  <button onclick="logout()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg flex items-center gap-2">
    <i class="fa-solid fa-right-from-bracket"></i> Logout
  </button>
</div>

<!-- Admission Section -->
<div class="bg-white text-black p-6 rounded-xl shadow-lg mb-6">
  <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
    <i class="fa-solid fa-user-check"></i> Admission
  </h2>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
    <input type="text" id="admName" placeholder="Name & Surname" class="p-2 rounded border w-full">
    <input type="text" id="admGrade" placeholder="Grade" class="p-2 rounded border w-full">
    <input type="number" id="admAge" placeholder="Age" class="p-2 rounded border w-full">
  </div>

  <div class="flex gap-4 mb-4">
    <button id="acceptBtn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded flex items-center gap-2">
      <i class="fa-solid fa-circle-check"></i> Accept
    </button>
    <button id="rejectBtn" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded flex items-center gap-2">
      <i class="fa-solid fa-circle-xmark"></i> Reject
    </button>
  </div>

  <div id="rejectReasonDiv" class="hidden mb-4">
    <label class="block mb-1 font-semibold">Select Reason for Rejection:</label>
    <select id="rejectReason" class="p-2 rounded border w-full">
      <option value="">Select Reason</option>
      <option value="Incomplete Application">Incomplete Application</option>
      <option value="Insufficient Grades">Insufficient Grades</option>
      <option value="Other">Other</option>
    </select>
  </div>

  <div class="flex gap-4">
    <button id="confirmAdmission" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">Confirm</button>
    <button id="downloadAdmission" class="bg-gray-500 px-4 py-2 rounded disabled:opacity-50" disabled>Download</button>
  </div>

  <div id="admReceipt" class="receipt-box hidden"></div>
</div>

<!-- Report Section -->
<div class="bg-white text-black p-6 rounded-xl shadow-lg">
  <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
    <i class="fa-solid fa-file-lines"></i> Report Generation
  </h2>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
    <input type="text" id="repName" placeholder="Name & Surname" class="p-2 rounded border w-full">
    <input type="number" id="repAge" placeholder="Age" class="p-2 rounded border w-full">
    <select id="repAttendance" class="p-2 rounded border w-full">
      <option value="">Attendance</option>
      <option value="0-25% - Poor">0-25% - Poor</option>
      <option value="25-50% - Average">25-50% - Average</option>
      <option value="50-75% - Good">50-75% - Good</option>
      <option value="75-100% - Outstanding">75-100% - Outstanding</option>
    </select>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
    <select id="repPerformance" class="p-2 rounded border w-full">
      <option value="">Performance</option>
      <option value="0-25% - Poor">0-25% - Poor</option>
      <option value="25-50% - Average">25-50% - Average</option>
      <option value="50-75% - Good">50-75% - Good</option>
      <option value="75-100% - Outstanding">75-100% - Outstanding</option>
    </select>
    <select id="repType" class="p-2 rounded border w-full">
      <option value="">Type of Report</option>
      <option value="Monthly">Monthly</option>
      <option value="Per Term">Per Term</option>
    </select>
    <input type="text" id="repComment" placeholder="Comments" class="p-2 rounded border w-full">
  </div>

  <div class="flex gap-4">
    <button id="confirmReport" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">Confirm</button>
    <button id="downloadReport" class="bg-gray-500 px-4 py-2 rounded disabled:opacity-50" disabled>Download</button>
  </div>

  <div id="reportReceipt" class="receipt-box hidden"></div>
</div>

<script>
const { jsPDF } = window.jspdf;

// ------------------ Admission Section ------------------
let admissionStatus = "";
let rejectReasonText = "";

document.getElementById("acceptBtn").addEventListener("click", () => {
  admissionStatus = "Accepted";
  document.getElementById("rejectReasonDiv").classList.add("hidden");
});

document.getElementById("rejectBtn").addEventListener("click", () => {
  admissionStatus = "Rejected";
  document.getElementById("rejectReasonDiv").classList.remove("hidden");
});

document.getElementById("confirmAdmission").addEventListener("click", () => {
  const name = document.getElementById("admName").value;
  const grade = document.getElementById("admGrade").value;
  const age = document.getElementById("admAge").value;
  const reason = document.getElementById("rejectReason").value;

  if(!name || !grade || !age || !admissionStatus) {
    alert("Fill all fields and select Accept or Reject.");
    return;
  }

  let receiptText = `Virtual Labs Admission Receipt\n\nName: ${name}\nGrade: ${grade}\nAge: ${age}\nStatus: ${admissionStatus}\n\n`;

  if(admissionStatus === "Accepted") {
    receiptText += "NB: Login credentials will be provided only after payment confirmation.\n";
  } else if(admissionStatus === "Rejected") {
    receiptText += `Reason for Rejection: ${reason || "Not specified"}\n`;
  }

  const receiptDiv = document.getElementById("admReceipt");
  receiptDiv.innerText = receiptText;
  receiptDiv.classList.remove("hidden");

  // Enable Download
  const downloadBtn = document.getElementById("downloadAdmission");
  downloadBtn.disabled = false;
});

document.getElementById("downloadAdmission").addEventListener("click", () => {
  const receiptText = document.getElementById("admReceipt").innerText;
  const doc = new jsPDF();
  doc.text(receiptText, 10, 20);
  doc.save("Admission_Receipt.pdf");
});

// ------------------ Report Section ------------------
document.getElementById("confirmReport").addEventListener("click", () => {
  const name = document.getElementById("repName").value;
  const age = document.getElementById("repAge").value;
  const attendance = document.getElementById("repAttendance").value;
  const performance = document.getElementById("repPerformance").value;
  const type = document.getElementById("repType").value;
  const comment = document.getElementById("repComment").value;

  if(!name || !age || !attendance || !performance || !type) {
    alert("Please fill all fields for report.");
    return;
  }

  const receiptText = `Virtual Labs Student Report\n\nName: ${name}\nAge: ${age}\nAttendance: ${attendance}\nPerformance: ${performance}\nReport Type: ${type}\nComments: ${comment}`;

  const receiptDiv = document.getElementById("reportReceipt");
  receiptDiv.innerText = receiptText;
  receiptDiv.classList.remove("hidden");

  // Enable Download
  document.getElementById("downloadReport").disabled = false;
});

document.getElementById("downloadReport").addEventListener("click", () => {
  const receiptText = document.getElementById("reportReceipt").innerText;
  const doc = new jsPDF();
  doc.text(receiptText, 10, 20);
  doc.save("Student_Report.pdf");
});

// Logout
function logout(){
  sessionStorage.removeItem("adminAccess");
  window.location.href = "index.html";
}
</script>
</body>
</html>