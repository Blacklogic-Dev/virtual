<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Virtual Lab | AI Powered Application Form</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(to bottom, #32cd32, #000);
    color: white;
  }
  .hidden { display: none; }
  .letter, #receipt { 
    font-family: "Courier New", monospace; 
    white-space: pre-line; 
    background: white; 
    color: black; 
    padding: 20px; 
    border-radius: 10px; 
    margin-top: 10px;
    font-weight: bold;
  }
  .banner {
    width: 100%;
    height: 300px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 20px;
    border-radius: 8px;
    background-size: cover;
    background-position: center;
    transition: background 1s ease-in-out;
  }
  .input-container { position: relative; }
  .input-container span {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    font-weight: bold;
    color: #32cd32;
  }
  .input-container span:hover::after {
    content: attr(data-tip);
    position: absolute;
    top: -25px;
    right: 0;
    background: #32cd32;
    color: black;
    padding: 5px 8px;
    border-radius: 4px;
    white-space: nowrap;
    font-size: 12px;
    z-index: 10;
  }
</style>
</head>
<body class="p-6">

<!-- Applicant Banner -->
<div class="banner relative" id="bannerApplicant"></div>

<!-- Tabs -->
<div class="flex justify-center gap-4 mb-6">
  <button id="applicantTab" class="px-4 py-2 bg-green-700 text-white rounded">Applicant</button>
  <button id="adminTab" class="px-4 py-2 bg-gray-300 text-black rounded">Admin</button>
</div>

<!-- Applicant Form -->
<div id="applicantSection">
  <form id="appForm" class="bg-gradient-to-br from-black to-green-700 p-6 rounded shadow-md max-w-xl mx-auto space-y-4 text-white">
    <h2 class="text-xl font-semibold mb-2">Personal Details</h2>

    <div class="input-container">
      <input type="text" id="name" placeholder="Full Names & Surname" class="w-full p-2 rounded text-black" required>
      <span data-tip="Enter your full legal names">?</span>
    </div>
    <div class="input-container">
      <input type="text" id="idNumber" placeholder="ID Number" class="w-full p-2 rounded text-black" required>
      <span data-tip="National ID number">?</span>
    </div>
    <div class="input-container">
      <input type="text" id="age" placeholder="Age" class="w-full p-2 rounded text-black" required>
      <span data-tip="Your age in years">?</span>
    </div>
    <div class="input-container">
      <select id="gender" class="w-full p-2 rounded text-black" required>
        <option value="">Select Gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <span data-tip="Select your gender">?</span>
    </div>
    <div class="input-container">
      <input type="text" id="address" placeholder="Physical Address" class="w-full p-2 rounded text-black" required>
      <span data-tip="Home address for contact">?</span>
    </div>
    <div class="input-container">
      <input type="email" id="email" placeholder="Email" class="w-full p-2 rounded text-black" required>
      <span data-tip="Your active email address">?</span>
    </div>
    <div class="input-container">
      <input type="text" id="whatsapp" placeholder="WhatsApp Number" class="w-full p-2 rounded text-black" required>
      <span data-tip="For receiving notifications">?</span>
    </div>

    <h2 class="text-xl font-semibold mb-2">School</h2>
    <div class="input-container">
      <input type="text" id="school" placeholder="School Name" class="w-full p-2 rounded text-black" required>
      <span data-tip="Name of your school">?</span>
    </div>
    <div class="input-container">
      <select id="grade" class="w-full p-2 rounded text-black" required>
        <option value="">Select Grade</option>
        <option value="Grade 9">Grade 9</option>
        <option value="Grade 10">Grade 10</option>
        <option value="Grade 11">Grade 11</option>
        <option value="Grade 12">Grade 12</option>
      </select>
      <span data-tip="Select your grade">?</span>
    </div>

    <div class="input-container">
      <select id="stream" class="w-full p-2 rounded text-black" required>
        <option value="">Select Stream</option>
        <option value="Maths & Science">Maths & Science</option>
        <option value="Business & Tourism">Business & Tourism</option>
      </select>
      <span data-tip="Select your preferred stream">?</span>
    </div>

    <h2 class="text-xl font-semibold mb-2">Parent / Guardian</h2>
    <div class="input-container">
      <input type="text" id="parentName" placeholder="Parent Initials & Surname" class="w-full p-2 rounded text-black" required>
      <span data-tip="Full name of parent or guardian">?</span>
    </div>
    <div class="input-container">
      <input type="text" id="parentNumber" placeholder="Parent Cellphone Number" class="w-full p-2 rounded text-black" required>
      <span data-tip="Active cellphone number">?</span>
    </div>

    <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition">Submit Application</button>
  </form>

  <div id="receipt" class="hidden"></div>

  <div class="text-center mt-2">
    <button id="notifyBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
      Notify Admin via WhatsApp
    </button>
  </div>
</div>

<!-- Admin Banner -->
<div class="banner hidden relative" id="bannerAdmin"></div>

<!-- Admin Login -->
<div id="adminLoginSection" class="hidden max-w-md mx-auto bg-white p-6 rounded shadow-md text-black">
  <h2 class="text-xl font-semibold mb-4 text-center">Admin Login</h2>
  <input type="text" id="adminUsername" placeholder="Username" class="w-full p-2 border rounded mb-2">
  <input type="password" id="adminPassword" placeholder="Password" class="w-full p-2 border rounded mb-4">
  <button id="adminLoginBtn" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">Login</button>
  <p id="loginError" class="text-red-600 mt-2 hidden text-center"></p>
</div>

<!-- Admin Panel -->
<div id="adminSection" class="hidden">
  <div id="applicantList" class="space-y-4 max-w-2xl mx-auto"></div>
</div>

<script>
let applicants = JSON.parse(localStorage.getItem("applicants")) || [];

// Tabs
const applicantTab = document.getElementById("applicantTab");
const adminTab = document.getElementById("adminTab");
const applicantSection = document.getElementById("applicantSection");
const adminSection = document.getElementById("adminSection");
const adminLoginSection = document.getElementById("adminLoginSection");
const bannerApplicant = document.getElementById("bannerApplicant");
const bannerAdmin = document.getElementById("bannerAdmin");

applicantTab.addEventListener("click", () => {
  applicantSection.classList.remove("hidden");
  adminSection.classList.add("hidden");
  adminLoginSection.classList.add("hidden");
  bannerApplicant.classList.remove("hidden");
  bannerAdmin.classList.add("hidden");
});
adminTab.addEventListener("click", () => {
  applicantSection.classList.add("hidden");
  adminSection.classList.add("hidden");
  adminLoginSection.classList.remove("hidden");
  bannerApplicant.classList.add("hidden");
  bannerAdmin.classList.remove("hidden");
});

// Banner slide functionality
const banners = [
  {el: bannerApplicant, images: ['labs.png', 'labs2.png']},
  {el: bannerAdmin, images: ['labs.png', 'labs2.png']}
];
banners.forEach(b => {
  let index = 0;
  setInterval(() => {
    index = (index + 1) % b.images.length;
    b.el.style.background = `url('${b.images[index]}') center/cover no-repeat`;
  }, 5000);
});

// Applicant Form Submission
const appForm = document.getElementById("appForm");
const receipt = document.getElementById("receipt");
appForm.addEventListener("submit", e => {
  e.preventDefault();
  const applicantNumber = "224" + Math.floor(Math.random()*100 + 10);
  const applicant = {
    id: applicantNumber,
    name: document.getElementById("name").value,
    idNumber: document.getElementById("idNumber").value,
    age: document.getElementById("age").value,
    gender: document.getElementById("gender").value,
    address: document.getElementById("address").value,
    email: document.getElementById("email").value,
    whatsapp: document.getElementById("whatsapp").value,
    school: document.getElementById("school").value,
    grade: document.getElementById("grade").value,
    stream: document.getElementById("stream").value,
    parentName: document.getElementById("parentName").value,
    parentNumber: document.getElementById("parentNumber").value,
    status: "Pending"
  };
  applicants.push(applicant);
  localStorage.setItem("applicants", JSON.stringify(applicants));

  generateLetter(applicant, receipt);
  appForm.reset();
});

// WhatsApp Notify
document.getElementById("notifyBtn").addEventListener("click", () => {
  window.open("https://wa.me/27606614909?text=New%20applicant%20please%20check%20Virtual%20Labs", "_blank");
});

// Admin Login
document.getElementById("adminLoginBtn").addEventListener("click", () => {
  const username = document.getElementById("adminUsername").value;
  const password = document.getElementById("adminPassword").value;
  const error = document.getElementById("loginError");

  if ((username === "KX0011" || username === "KX1011") && password === "BlackLogic@24") {
    adminLoginSection.classList.add("hidden");
    adminSection.classList.remove("hidden");
    renderAdminPanel();
    error.classList.add("hidden");
  } else {
    error.textContent = "Invalid credentials!";
    error.classList.remove("hidden");
  }
});

// Admin Panel Rendering
function renderAdminPanel() {
  const applicantList = document.getElementById("applicantList");
  applicantList.innerHTML = "";
  if(applicants.length === 0) {
    applicantList.innerHTML = "<p class='text-center'>No applicants yet.</p>";
    return;
  }
  applicants.forEach(app => {
    const card = document.createElement("div");
    card.className = "bg-white p-4 rounded shadow-md font-mono text-black";
    let statusColor = app.status === "Approved" ? "text-green-600" : app.status === "Rejected" ? "text-red-600" : "text-gray-700";

    card.innerHTML = `
      <h3 class="font-semibold text-lg mb-2">${app.name} (${app.age} y/o, ${app.grade})</h3>
      <p class="${statusColor} mb-2">Status: ${app.status}</p>
      <div class="mt-2 flex gap-2 flex-wrap">
        <button class="approve bg-green-600 text-white px-3 py-1 rounded">Approve</button>
        <button class="reject bg-red-600 text-white px-3 py-1 rounded">Reject</button>
        <button class="share bg-blue-600 text-white px-3 py-1 rounded">Share Response</button>
        <button class="delete bg-black text-white border border-green-600 px-3 py-1 rounded">Delete</button>
      </div>
      <div class="letter mt-3 hidden"></div>
    `;

    // Approve / Reject
    card.querySelector(".approve").addEventListener("click", () => { 
      app.status="Approved"; 
      localStorage.setItem("applicants", JSON.stringify(applicants)); 
      generateLetter(app, card.querySelector(".letter")); 
      renderAdminPanel(); 
    });
    card.querySelector(".reject").addEventListener("click", () => { 
      app.status="Rejected"; 
      localStorage.setItem("applicants", JSON.stringify(applicants)); 
      generateLetter(app, card.querySelector(".letter")); 
      renderAdminPanel(); 
    });

    // Share
    card.querySelector(".share").addEventListener("click", () => {
      if(app.status==="Pending") return alert("Approve or reject first!");
      const msg = encodeURIComponent(card.querySelector(".letter").innerText);
      window.open(`https://wa.me/${app.parentNumber.replace(/\D/g,'')}?text=${msg}`, "_blank");
    });

    // Delete with username confirmation
    card.querySelector(".delete").addEventListener("click", () => {
      const adminConfirm = prompt("Enter admin username to confirm deletion:");
      if(adminConfirm === "KX0011" || adminConfirm === "KX1011") {
        applicants = applicants.filter(a => a.id !== app.id);
        localStorage.setItem("applicants", JSON.stringify(applicants));
        renderAdminPanel();
      } else {
        alert("Incorrect username! Deletion cancelled.");
      }
    });

    applicantList.appendChild(card);
  });
}

// Generate Letters
function generateLetter(applicant, container) {
  const dateTime = new Date().toLocaleString();
  container.style.fontFamily = "Courier New, monospace";
  container.style.background = "white";
  container.style.color = "black";
  container.style.fontWeight = "bold";
  container.style.padding = "20px";
  container.style.borderRadius = "10px";
  container.style.marginTop = "10px";

  if(applicant.status === "Approved") {
    container.innerHTML = `Date: ${dateTime}

Dear ${applicant.name},

Congratulations! Your application has been approved.

Registration Fee: R250
Access Fee: R750
Total: R1000 per month (25 days)

Package Includes:
- Unlimited AI Assistant
- Unlimited Textbook Access
- Unlimited Video Lessons
- Daily Live Class

Upon confirmation of payment, you will receive a unique Student ID and password to access Master Science Hub or TourBiz Zone.

Sincerely,
Virtual Lab Team`;
  } else if(applicant.status === "Rejected") {
    container.innerHTML = `Date: ${dateTime}

Dear ${applicant.name},

We regret to inform you that your application has been rejected.

Thank you for your interest in Virtual Lab.

Sincerely,
Virtual Lab Team`;
  } else { // applicant receipt
    container.innerHTML = `Dear applicant number ${applicant.id},

Thank you for submitting your application. It has been received.

We will respond within the next 15 minutes to 1 hour. Stay tuned on WhatsApp.

${dateTime}`;
  }

  container.classList.remove("hidden");
}

// Initial render
renderAdminPanel();
</script>
</body>
</html>